# This Docker Compose project is not intended to be executed directly.
# Instead, this project is meant to be merged with one of the
# `compose.production.yml` or `compose.standalone.yml` projects.

version: "3"

services:
  app:
    build:
      context: .
      target: app
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      - POSTGRES_DB=${POSTGRES_DB:?}
      - POSTGRES_USER=${POSTGRES_USER:?}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:?}
      - POSTGRES_HOST=${POSTGRES_HOST:?}


  tests:
    build:
      context: .
      target: tests
      dockerfile: Dockerfile
    environment:
      - POSTGRES_TEST_DB=${POSTGRES_TEST_DB:?}
      - POSTGRES_TEST_USER=${POSTGRES_TEST_USER:?}
      - POSTGRES_TEST_PASSWORD=${POSTGRES_TEST_PASSWORD:?}
      - POSTGRES_TEST_HOST=${POSTGRES_TEST_HOST:?}